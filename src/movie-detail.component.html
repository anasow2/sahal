
@if (movie(); as movieData) {
<main class="flex-grow flex flex-col w-full pt-24 md:pt-32 pb-20">
  <div class="px-6 md:px-12 max-w-[1600px] mx-auto w-full">
    <!-- Back Button -->
    <a
      routerLink="/"
      class="inline-flex items-center gap-2 text-gray-300 hover:text-primary transition-colors mb-8 group"
    >
      <span
        class="material-symbols-outlined group-hover:-translate-x-1 transition-transform"
        >arrow_back</span
      >
      Back to Home
    </a>

    <!-- Movie Details Layout -->
    <div class="flex flex-col md:flex-row gap-8 md:gap-12">
      <!-- Left Column: Poster -->
      <div class="w-full md:w-1/3 xl:w-1/4 flex-shrink-0">
        <div class="aspect-[2/3] rounded-xl overflow-hidden shadow-2xl">
          <img
            [src]="movieData.imageUrl"
            [alt]="movieData.title"
            class="w-full h-full object-cover"
          />
        </div>
      </div>

      <!-- Right Column: Info -->
      <div class="flex-grow">
        <!-- Badge, Year, Genre -->
        <div class="flex items-center gap-4 mb-3 text-gray-400">
          @if(movieData.badge) {
          <span
            class="px-2 py-0.5 bg-primary/20 text-primary text-xs font-bold uppercase rounded"
            >{{ movieData.badge }}</span
          >
          }
          <span>{{ movieData.year }}</span>
          <span class="w-1 h-1 bg-gray-600 rounded-full"></span>
          <span>{{ movieData.genre }}</span>
          @if(movieData.rating) {
          <span class="w-1 h-1 bg-gray-600 rounded-full"></span>
          <div class="flex items-center gap-0.5">
            @for(star of starRating(); track $index) {
                @switch (star) {
                    @case ('full') {
                        <span class="material-symbols-outlined text-base fill text-yellow-500">star</span>
                    }
                    @case ('half') {
                        <span class="material-symbols-outlined text-base fill text-yellow-500">star_half</span>
                    }
                    @case ('empty') {
                        <span class="material-symbols-outlined text-base text-gray-600">star</span>
                    }
                }
            }
            <span class="text-xs text-gray-400 font-medium ml-2 tabular-nums">({{ movieData.rating }})</span>
          </div>
          }
        </div>

        <!-- Title -->
        <h1
          class="text-4xl md:text-6xl font-black text-white leading-tight tracking-tighter mb-6"
        >
          {{ movieData.title }}
        </h1>

        <!-- Synopsis -->
        <div class="mb-8">
          <h2 class="text-xl font-bold text-white mb-3">Synopsis</h2>
          <p class="text-gray-300 leading-relaxed max-w-3xl">
            {{ movieData.synopsis }}
          </p>
        </div>

        <!-- Cast -->
        <div class="mb-10">
          <h2 class="text-xl font-bold text-white mb-4">Cast</h2>
          <div class="flex flex-wrap gap-x-6 gap-y-3">
            @for (actor of movieData.cast; track actor.name) {
            <button
              (click)="selectActor(actor)"
              class="text-gray-300 hover:text-primary hover:underline transition-colors focus:outline-none"
            >
              {{ actor.name }}
            </button>
            }
          </div>
        </div>

        <!-- Trailer -->
        @if(safeTrailerUrl(); as url) {
        <div>
          <h2 class="text-xl font-bold text-white mb-4">Trailer</h2>
          <div
            class="aspect-video max-w-3xl rounded-lg overflow-hidden border border-white/10"
          >
            <iframe
              [src]="url"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
              class="w-full h-full"
            ></iframe>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</main>

<!-- Actor Bio Modal -->
@if (selectedActor(); as actor) {
<div
  (click)="deselectActor()"
  class="fixed inset-0 bg-black/70 z-[100] flex items-center justify-center animate-fade-in backdrop-blur-sm"
>
  <div
    (click)="$event.stopPropagation()"
    class="bg-card-dark rounded-xl shadow-2xl w-full max-w-lg m-4 p-8 relative border border-white/10"
  >
    <button
      (click)="deselectActor()"
      class="absolute top-3 right-3 text-gray-400 hover:text-white transition-colors p-1 rounded-full hover:bg-white/10"
    >
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="flex flex-col sm:flex-row items-center sm:items-start gap-6 text-center sm:text-left">
      <img
        [src]="actor.imageUrl"
        [alt]="actor.name"
        class="w-32 h-32 rounded-full object-cover border-4 border-primary/50 flex-shrink-0"
      />
      <div>
        <h3 class="text-3xl font-bold text-white">{{ actor.name }}</h3>
        <p class="text-gray-300 mt-4 text-sm leading-relaxed">
          {{ actor.bio }}
        </p>
      </div>
    </div>
  </div>
</div>
}
} @else {
<main
  class="flex-grow flex flex-col items-center justify-center w-full text-center px-4"
>
  <span class="material-symbols-outlined text-8xl text-primary mb-4"
    >error</span
  >
  <h1 class="text-4xl font-bold text-white mb-2">Movie Not Found</h1>
  <p class="text-gray-400 mb-8">
    We couldn't find the movie you were looking for.
  </p>
  <a
    routerLink="/"
    class="inline-flex items-center gap-2 bg-primary hover:bg-red-700 text-white px-6 py-3 rounded-lg font-bold text-lg transition-all transform hover:scale-105"
  >
    <span class="material-symbols-outlined">home</span>
    Return to Home
  </a>
</main>
}
